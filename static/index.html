<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESå…¥åŠ› - ã‚¹ãƒ©ã‚¤ãƒ‰ä½œæˆã‚¢ãƒ—ãƒª</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“ ã‚¹ãƒ©ã‚¤ãƒ‰ä½œæˆã‚¢ãƒ—ãƒª</h1>
            <p>ESï¼ˆè‡ªå·±PRç­‰ï¼‰ã‚’å…¥åŠ›ã—ã¦ã€ã‚¹ãƒ©ã‚¤ãƒ‰æ§‹æˆæ¡ˆã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™</p>
        </header>

        <main>
            <div id="sections-container">
                <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒã“ã“ã«è¿½åŠ ã•ã‚Œã‚‹ -->
            </div>

            <div class="button-group">
                <button onclick="addSection()" class="btn btn-secondary">
                    â• ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
                </button>
                <button onclick="generateSlides()" class="btn btn-primary">
                    ğŸš€ æ§‹æˆæ¡ˆã‚’ç”Ÿæˆ
                </button>
            </div>

            <div id="loading" class="loading hidden">
                <div class="spinner"></div>
                <p>æ§‹æˆæ¡ˆã‚’ç”Ÿæˆä¸­...</p>
            </div>
        </main>
    </div>

    <script>
        let sectionCount = 0;

        // åˆæœŸã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
        window.addEventListener('DOMContentLoaded', () => {
            addSection();
        });

        function addSection() {
            sectionCount++;
            const container = document.getElementById('sections-container');

            const sectionDiv = document.createElement('div');
            sectionDiv.className = 'section-card';
            sectionDiv.id = `section-${sectionCount}`;

            sectionDiv.innerHTML = `
                <div class="section-header">
                    <input type="text"
                           class="section-title"
                           placeholder="ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆä¾‹: è‡ªå·±ç´¹ä»‹ã€å¼·ã¿ã€å®Ÿç¸¾ï¼‰"
                           value="${sectionCount === 1 ? 'è‡ªå·±ç´¹ä»‹' : ''}">
                    <button onclick="removeSection(${sectionCount})" class="btn-remove">
                        ğŸ—‘ï¸
                    </button>
                </div>
                <textarea class="section-content"
                          placeholder="æœ¬æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„&#10;&#10;ä¾‹ï¼š&#10;ç§ã¯ã€‡ã€‡å¤§å­¦ã§â–³â–³ã‚’å°‚æ”»ã—ã¦ã„ã¾ã™ã€‚&#10;ã“ã‚Œã¾ã§â–¡â–¡ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å–ã‚Šçµ„ã¿ã€â—‡â—‡ã®æˆæœã‚’ä¸Šã’ã¾ã—ãŸã€‚"
                          rows="6"></textarea>
            `;

            container.appendChild(sectionDiv);
        }

        function removeSection(id) {
            const section = document.getElementById(`section-${id}`);
            if (section) {
                section.remove();
            }
        }

        async function generateSlides() {
            // ã‚»ã‚¯ã‚·ãƒ§ãƒ³æƒ…å ±ã‚’åé›†
            const sections = [];
            const sectionCards = document.querySelectorAll('.section-card');

            sectionCards.forEach(card => {
                const title = card.querySelector('.section-title').value.trim();
                const content = card.querySelector('.section-content').value.trim();

                // æœ¬æ–‡ãŒç©ºã§ãªã„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã¿è¿½åŠ 
                if (content) {
                    sections.push({ title, content });
                }
            });

            if (sections.length === 0) {
                alert('å°‘ãªãã¨ã‚‚1ã¤ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«æœ¬æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
            document.getElementById('loading').classList.remove('hidden');

            try {
                const response = await fetch('/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ sections })
                });

                if (!response.ok) {
                    throw new Error('ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
                }

                const data = await response.json();

                // ã‚¹ãƒ©ã‚¤ãƒ‰ç¢ºèªç”»é¢ã«é·ç§»ï¼ˆãƒ‡ãƒ¼ã‚¿ã‚’localStorageã«ä¿å­˜ï¼‰
                localStorage.setItem('slidesData', JSON.stringify(data.slides));
                window.location.href = '/static/slides.html';

            } catch (error) {
                console.error('Error:', error);
                alert('æ§‹æˆæ¡ˆã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }
    </script>
</body>
</html>
